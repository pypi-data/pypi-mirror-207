(self.webpackChunkpeaksjs_widget=self.webpackChunkpeaksjs_widget||[]).push([[367],{657:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const n=i(147);t.MODULE_VERSION=n.version,t.MODULE_NAME=n.name},367:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{r(n.next(e))}catch(e){s(e)}}function l(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}r((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeaksJSView=t.PeaksJSModel=void 0;const s=i(657),a=o(i(122));i(204);const l=i(985),r=o(i(989)),d=o(i(600)),c=i(708);class u{constructor(e){this._options=e}init(e){this.handleHeight=20,this._handle=new d.default.Rect({x:-4.5,y:0,width:10,height:this.handleHeight,fill:this._options.color}),this._line=new d.default.Line({stroke:this._options.color,strokeWidth:1}),e.add(this._handle),e.add(this._line),this.fitToView()}fitToView(){const e=this._options.layer.getHeight();this._handle.y(e/2-this.handleHeight/2),this._line.points([.5,0,.5,e])}timeUpdated(){}destroy(){}}function m(e){return new u(e)}class p extends l.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:p.model_name,_model_module:p.model_module,_model_module_version:p.model_module_version,_view_name:p.view_name,_view_module:p.view_module,_view_module_version:p.view_module_version})}}t.PeaksJSModel=p,p.serializers=Object.assign({zoomview:{deserialize:l.unpack_models},overview:{deserialize:l.unpack_models},play_button:{deserialize:l.unpack_models},save_button:{deserialize:l.unpack_models},audio:{deserialize:l.unpack_models}},l.DOMWidgetModel.serializers),p.model_name="PeaksJSModel",p.model_module=s.MODULE_NAME,p.model_module_version=s.MODULE_VERSION,p.view_name="PeaksJSView",p.view_module=s.MODULE_NAME,p.view_module_version=s.MODULE_VERSION;class h extends l.DOMWidgetView{render(){super.render(),this.model.on("change:zoomview",this.init_zoomview,this),this.model.on("change:overview",this.init_overview,this),this.model.on("change:play_button",this.init_play_button,this),this.model.on("change:save_button",this.init_save_button,this),this.model.on("change:audio",this.init_peaks,this),this.model.on("change:segments",this.segments_changed,this),this.model.on("change:points",this.points_changed,this),this.model.on("change:playing",this.toggle_playing,this),this.views=new l.ViewList(this.add_view,null,this);const e=this;this.listenTo(this.model,"change:segments",this.segments_changed),this.listenTo(this.model,"change:points",this.points_changed),this.displayed.then((()=>{e.init_zoomview(),e.init_overview(),e.init_play_button(),e.init_save_button(),e.init_peaks()})),this.views.update([this.model.get("zoomview"),this.model.get("overview"),this.model.get("play_button"),this.model.get("save_button"),this.model.get("audio")]).then((e=>e.map((e=>e.render()))));const t=this.model.get("element_id");a.default(this.el).attr("id",t)}add_view(e,t){return this.create_child_view(e,{parent:this}).then((e=>(e.trigger("displayed"),e))).catch((e=>e))}init_zoomview(){const e=this,t=this.model.get("element_id");this.views.views[0].then((i=>{e.zoomview=a.default(i.el).text("\n").attr("id","zoomview-"+t).attr("tabindex","0").css({width:"100%",height:"200px","white-space":"pre"}),e.model.get("as_container")&&a.default(e.el).append(e.zoomview)}))}init_overview(){const e=this,t=this.model.get("element_id");this.views.views[1].then((i=>{e.overview=a.default(i.el).text("\n").attr("id","overview-"+t).css({width:"100%",height:"15px","white-space":"pre"}),e.model.get("as_container")&&a.default(e.el).append(e.overview)}))}init_play_button(){const e=this.model,t=this;this.views.views[2].then((i=>{this.playBtn=a.default(i.el).on("click",(function(){const i=e.get("playing");e.set("playing",!i),e.save_changes(),t.touch(),t.send({playing:!i})})),t.model.get("as_container")&&a.default(this.el).append(this.playBtn)}))}init_save_button(){const e=this;this.views.views[3].then((t=>{a.default(e.el).append(a.default(t.el).on("click",(function(){const t=document.createElement("a");t.href=e.audio.src,t.setAttribute("download",`${e.model.get("element_id")}.mp3`),document.body.appendChild(t),t.click()})))}))}init_peaks(){const e=this,t=this.model.get("segments"),i=this.model.get("points"),o=this.model.get("sample_rate");Promise.all(this.views.views).then((s=>{const l=s[4].el;l.preload="metadata",l.onloadedmetadata=d=>{const u=new AudioContext({sampleRate:o}),p=s[0].el,h=s[1].el;let v=e.model.get("min_samples_per_pixel");a.default(e.el).append(l),e.audio=l;const g={waveformCache:!0,zoomview:{container:p,waveformColor:"rgba(0,100,255,0.95)",playheadColor:"#000000",wheelMode:"scroll",timeLabelPrecision:4,showPlayheadTime:!0},overview:{container:h,waveformColor:"rgba(0,100,255,0.95)",playheadColor:"#000000",showAxisLabels:!1,highlightOffset:0},zoomLevels:[v,2*v,3*v,4*v,6*v,10*v],mediaElement:l,webAudio:{audioContext:u,scale:v,multiChannel:!1},keyboard:!1,nudgeIncrement:1,segments:t,points:i,createSegmentMarker:m};r.default.init(g,(function(t,i){return n(this,void 0,void 0,(function*(){if(t||null==i)return void console.error("Failed to initialize Peaks instance: "+t.message);e.peaks=i;const o=i.views.getView("zoomview");o.setZoom({seconds:Math.min(l.duration,180)}),i.on("zoomview.contextmenu",(t=>{if(t.evt.preventDefault(),t.evt.stopImmediatePropagation(),t.evt.stopPropagation(),t.evt.ctrlKey&&!t.evt.altKey&&!t.evt.shiftKey){const n={time:t.time,color:"#ff640e",editable:!0},{id:o}=i.points.add(n);e.send({newPoint:Object.assign(Object.assign({},n),{id:o})})}})),i.on("zoomview.click",(t=>{if(t.evt.altKey&&!t.evt.shiftKey&&!t.evt.ctrlKey){const n={startTime:t.time,endTime:t.time+.1,editable:!0,id:e.model.get("id_count"),color:"#ff640e",labelText:""};i.segments.add(n),e.model.set("id_count",n.id+1),e.touch(),e.send({newSegment:n})}})),i.on("segments.click",(t=>{if(t.evt.preventDefault(),t.evt.stopImmediatePropagation(),t.evt.stopPropagation(),t.evt.shiftKey)i.segments.removeById(t.segment.id),e.send({removeSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText}}),t.evt.preventDefault();else if(t.evt.ctrlKey&&t.evt.altKey){const i=prompt("Enter segment label","0");t.segment.update({labelText:i}),e.send({editSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:i,editable:!0}})}else e.send({clickSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText,editable:t.segment.editable}})})),i.on("segments.dragend",(t=>{e.send({editSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText,editable:!0}})})),i.on("points.dragend",(t=>{e.send({editPoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:t.point.labelText,editable:!0}})})),i.on("points.click",(t=>{if(t.evt.preventDefault(),t.evt.stopImmediatePropagation(),t.evt.stopPropagation(),t.evt.shiftKey)e.send({removePoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:t.point.labelText}}),t.evt.preventDefault();else if(t.evt.ctrlKey&&t.evt.altKey){const i=prompt("Enter point label","0");t.point.update({labelText:i}),e.send({editPoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:i,editable:!0}})}})),i.on("player.seeked",(e=>{})),p.addEventListener("keydown",(t=>{if("Space"===t.code)e.playBtn.trigger("click"),t.preventDefault();else if(t.code.includes("Arrow")){const e=i.player.getCurrentTime(),n=i.views.getView("zoomview"),o=n.getEndTime()-n.getStartTime();let s=.002;t.shiftKey&&(s=.02),"ArrowRight"===t.code?i.player.seek(e+o*s):"ArrowLeft"===t.code&&i.player.seek(e-o*s)}})),p.addEventListener("wheel",(t=>{const n=i.views.getView("zoomview");n&&t.ctrlKey&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),c.zoom(i,n,t,v,5),e.send({updateZoomView:{startTime:n.getStartTime(),endTime:n.getEndTime()}}))})),p.addEventListener("dblclick",(t=>{t.shiftKey?i.views.getView("zoomview").setZoom({seconds:Math.min(i.player.getDuration(),180)}):t.altKey||e.playBtn.trigger("click")})),i.once("peaks.ready",(()=>n(this,void 0,void 0,(function*(){yield c.cacheResampledData(o,50,5,v)}))))}))}))}}))}segments_changed(){let e=this.model.get("segments");this.peaks.segments.removeAll(),this.peaks.segments.add(e)}points_changed(){let e=this.model.get("points");this.peaks.points.removeAll(),this.peaks.points.add(e)}toggle_playing(){this.model.get("playing")?(this.peaks.player.play(),this.playBtn.children("i").removeClass("fa-play").addClass("fa-pause")):(this.peaks.player.pause(),this.playBtn.children("i").removeClass("fa-pause").addClass("fa-play"))}}t.PeaksJSView=h},708:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{r(n.next(e))}catch(e){s(e)}}function l(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}r((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.cacheResampledData=t.zoom=void 0,t.zoom=function(e,t,i,n,o){const s=t._data,a=s.length;let l=i.wheelDelta>0?.95:1.05;const r=e.player.getCurrentTime();let d,c=t._playheadLayer.getPlayheadOffset();c>=0&&c<t._width?d=r:(c=Math.floor(t._width/2),d=t.pixelOffsetToTime(c));const u=Math.max(Math.min(a*l,s.duration*s.sample_rate/n),s.duration*t._width/Math.min(180,s.duration));let m=Math.floor(s.duration*s.sample_rate/u);l>1?m=Math.floor(m/o)*o:(m=Math.ceil(m/o)*o,m===t._scale&&(m+=o)),t._resampleData({scale:m}),t._updateWaveform(t.timeToPixels(d)-c),t._playheadLayer.zoomLevelChanged(t._framOffset),t._playheadLayer.updatePlayheadTime(r)},t.cacheResampledData=function(e,t,n,o){return i(this,void 0,void 0,(function*(){yield Promise.all([...Array(t+1).keys()].map((t=>setTimeout((()=>function(t){return i(this,void 0,void 0,(function*(){if((t*=n)>o){let i;i=e._waveformData.has(t-n)?e._waveformData.get(t-n):e._originalWaveformData,e._waveformData.set(t,i.resample({scale:t})),e._waveformScales.push(t)}}))}(t)),0)))).then((t=>e._waveformScales.sort((function(e,t){return e-t}))))}))}},889:(e,t,i)=>{(t=i(645)(!1)).push([e.id,"\n",""]),e.exports=t},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,n,o,s=e[1]||"",a=e[3];if(!a)return s;if(t&&"function"==typeof btoa){var l=(i=a,n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(o," */")),r=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[s].concat(r).concat([l]).join("\n")}return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(n)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(o[a]=!0)}for(var l=0;l<e.length;l++){var r=[].concat(e[l]);n&&o[r[0]]||(i&&(r[2]?r[2]="".concat(i," and ").concat(r[2]):r[2]=i),t.push(r))}},t}},204:(e,t,i)=>{var n=i(379),o=i(889);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.id,o,""]]);n(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},379:(e,t,i)=>{"use strict";var n,o=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),s=[];function a(e){for(var t=-1,i=0;i<s.length;i++)if(s[i].identifier===e){t=i;break}return t}function l(e,t){for(var i={},n=[],o=0;o<e.length;o++){var l=e[o],r=t.base?l[0]+t.base:l[0],d=i[r]||0,c="".concat(r," ").concat(d);i[r]=d+1;var u=a(c),m={css:l[1],media:l[2],sourceMap:l[3]};-1!==u?(s[u].references++,s[u].updater(m)):s.push({identifier:c,updater:v(m,t),references:1}),n.push(c)}return n}function r(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=i.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var a=o(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var d,c=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,i,n){var o=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=c(t,o);else{var s=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}function m(e,t,i){var n=i.css,o=i.media,s=i.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var p=null,h=0;function v(e,t){var i,n,o;if(t.singleton){var s=h++;i=p||(p=r(t)),n=u.bind(null,i,s,!1),o=u.bind(null,i,s,!0)}else i=r(t),n=m.bind(null,i,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var i=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var o=a(i[n]);s[o].references--}for(var r=l(e,t),d=0;d<i.length;d++){var c=a(i[d]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}i=r}}}},147:e=>{"use strict";e.exports=JSON.parse('{"name":"peaksjs-widget","version":"0.1.4","description":"ipywidget to interact with audio waveforms through peaks.js","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/ktonal/peaksjs-widget","bugs":{"url":"https://github.com/ktonal/peaksjs-widget/issues"},"license":"BSD-3-Clause","author":{"name":"AntoineDaurat","email":"ktonalberlin@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/ktonal/peaksjs-widget"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf peaksjs_widget/labextension","clean:nbextension":"rimraf peaksjs_widget/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^6","@jupyter-widgets/controls":"^5","konva":"^8.3.10","peaks.js":"^2.0.2","underscore":"^1.13.6","waveform-data":">= 4.3.0 < 5","jquery":"^3.6.4"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyter-widgets/base-manager":"^1.0.2","@jupyterlab/builder":"^3.0.0","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.61.0","webpack-cli":"^4.0.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"peaksjs_widget/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);