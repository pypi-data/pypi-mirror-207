{% load django_auxiliaries_tags aldine_tags tour_guide_tags %}
{% block prologue %}
{% endblock %}
<figure class="{{ css_classes }}">
{% for cell, item in cells_and_items %}
{% if figure.anchor_category %}
{% concat figure.anchor_category '-' figure_id '-' cell.source_order|add:'1' as subfigure_id %}
{% define_anchor figure.anchor_category cell.annotations.caption.anchor_identifier|default:subfigure_id level=figure.anchor_level|default_if_none:0 as figure_anchor_id %}
{% endif %}
<figure {% if figure_anchor_id %}id="{{figure_anchor_id}}"{% endif %}{% if cell.annotations.figure_css_class %}class="{{ cell.annotations.figure_css_class }}"{% endif %}
    {% if cell.annotations.padding and cell.annotations.padding.is_defined %}
    style="{% if cell.annotations.padding.top and cell.annotations.padding.top.value %} padding-top: {{ cell.annotations.padding.top }};{% endif %}{% if cell.annotations.padding.right and cell.annotations.padding.right.value %} padding-right: {{ cell.annotations.padding.right }};{% endif %}{% if cell.annotations.padding.bottom and cell.annotations.padding.bottom.value %} padding-bottom: {{ cell.annotations.padding.bottom }};{% endif %}{% if cell.annotations.padding.left and cell.annotations.padding.left.value %} padding-left: {{ cell.annotations.padding.left }};{% endif %}"
    {% endif %} >
    {% if cell.annotations.link %}<a href="{{ cell.annotations.link }}">{% endif %}
    {% render_responsive_cell responsive_delegate cell item=item %}
    {% if cell.annotations.link %}</a>{% endif %}
    {% if figure.show_captions %}
        <figcaption{% if cell.annotations.caption_css_class %} class="{{ cell.annotations.caption_css_class }}"{% endif %}{% if cell.annotations.caption_alignment %} style="text-align: {{ cell.annotations.caption_alignment }};"{% endif %}>
        {% if figure.anchor_category and cell.annotations.caption.anchor_identifier %}
        <span class="{{ cell.annotations.caption_label_css_class }}">{% label_anchor figure.anchor_category cell.annotations.caption.anchor_identifier %}</span>
        {% endif %}
        {% if cell.annotations.caption_text_css_class and cell.annotations.caption.text %}<span class="{{ cell.annotations.caption_text_css_class }}">{{ cell.annotations.caption.text }}</span>{% else %}{{ cell.annotations.caption.text }}{% endif %}
        </figcaption>
    {% endif %}
</figure>
{% endfor %}
{% block caption_prologue %}
{% endblock %}
{% if figure.caption %}<figcaption>{{ figure.caption }}</figcaption>{% endif %}
{% block caption_epilogue %}
{% endblock %}
</figure>
{% block epilogue %}
{% endblock %}