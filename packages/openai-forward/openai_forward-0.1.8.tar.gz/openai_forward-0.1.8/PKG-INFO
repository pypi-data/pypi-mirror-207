Metadata-Version: 2.1
Name: openai_forward
Version: 0.1.8
Summary: ğŸš€ Openai api forward Â· OpenAI æ¥å£è½¬å‘æœåŠ¡ Â· stream forwarding
Project-URL: Homepage, https://github.com/beidongjiedeguang/openai-forward
Project-URL: Documentation, https://github.com/beidongjiedeguang/openai-forward#openai-forward
Project-URL: Issues, https://github.com/beidongjiedeguang/openai-forward/issues
Project-URL: Source, https://github.com/beidongjiedeguang/openai-forward
Author-email: kunyuan <beidongjiedeguang@gmail.com>
License-File: LICENSE
Keywords: chatgpt,fastapi,forward,openai,openai-api,openai-proxy,python,streaming-api
Classifier: Development Status :: 5 - Production/Stable
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Requires-Python: >=3.6
Requires-Dist: fastapi
Requires-Dist: httpx
Requires-Dist: loguru
Requires-Dist: orjson
Requires-Dist: python-dotenv
Requires-Dist: pytz
Requires-Dist: sparrow-python>=0.1.2
Requires-Dist: uvicorn
Provides-Extra: bard
Requires-Dist: googlebard; extra == 'bard'
Provides-Extra: chatgpt
Requires-Dist: revchatgpt; extra == 'chatgpt'
Provides-Extra: edge
Requires-Dist: edgegpt; extra == 'edge'
Provides-Extra: ssl
Requires-Dist: certbot; extra == 'ssl'
Description-Content-Type: text/markdown

**ä¸­æ–‡** | [**English**](./README_EN.md)

<h1 align="center">
    <br>
    OpenAI Forward
    <br>
</h1>
<p align="center">
    <b> OpenAI API æ¥å£è½¬å‘æœåŠ¡ <br/>
    The fastest way to deploy openai api forwarding </b>
</p>

<p align="center">
    <a href="https://pypi.org/project/openai-forward/"><img src="https://img.shields.io/pypi/v/openai-forward?color=brightgreen" alt="PyPI version" ></a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/blob/main/LICENSE">
        <img alt="License" src="https://img.shields.io/github/license/beidongjiedeguang/openai-forward.svg?color=blue&style=flat-square">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/releases">
        <img alt="Release (latest by date)" src="https://img.shields.io/github/v/release/beidongjiedeguang/openai-forward">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward">
        <img alt="GitHub repo size" src="https://img.shields.io/github/repo-size/beidongjiedeguang/openai-forward">
    </a>
    <a href="https://hub.docker.com/r/beidongjiedeguang/openai-forward">
        <img alt="docer image size" src="https://img.shields.io/docker/image-size/beidongjiedeguang/openai-forward?style=flat&label=docker image">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/actions/workflows/run_tests.yaml">
        <img alt="tests" src="https://img.shields.io/github/actions/workflow/status/beidongjiedeguang/openai-forward/run_tests.yml?label=tests">
    </a>
    <a href="https://pypi.org/project/openai_forward/">
        <img alt="pypi downloads" src="https://img.shields.io/pypi/dm/openai_forward">
    </a>
    <a href="https://codecov.io/gh/beidongjiedeguang/openai-forward">
        <img alt="codecov" src="https://codecov.io/gh/beidongjiedeguang/openai-forward/branch/dev/graph/badge.svg">
    </a>
</p>



æœ¬é¡¹ç›®ç”¨äºè§£å†³ä¸€äº›åœ°åŒºæ— æ³•ç›´æ¥è®¿é—®OpenAIçš„é—®é¢˜ï¼Œå°†è¯¥æœåŠ¡éƒ¨ç½²åœ¨å¯ä»¥æ­£å¸¸è®¿é—®openai
apiçš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è¯¥æœåŠ¡è½¬å‘OpenAIçš„è¯·æ±‚ã€‚å³æ­å»ºåå‘ä»£ç†æœåŠ¡  
æµ‹è¯•è®¿é—®ï¼šhttps://caloi.top/openai/v1/chat/completions å°†ç­‰ä»·äº https://api.openai.com/v1/chat/completions  
æˆ–è€…è¯´ https://caloi.top/openai ç­‰ä»·äº https://api.openai.com

# Table of Contents

- [Features](#Features)
- [åº”ç”¨](#åº”ç”¨)
- [å®‰è£…éƒ¨ç½²](#å®‰è£…éƒ¨ç½²)
- [æœåŠ¡è°ƒç”¨](#æœåŠ¡è°ƒç”¨)
- [é…ç½®é€‰é¡¹](#é…ç½®é€‰é¡¹)
- [èŠå¤©æ—¥å¿—](#èŠå¤©æ—¥å¿—)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)

# Features

- [x] æ”¯æŒè½¬å‘OpenAIæ‰€æœ‰æ¥å£
- [x] æ”¯æŒæµå¼å“åº”
- [x] å®æ—¶è®°å½•èŠå¤©è®°å½•(åŒ…æ‹¬æµå¼å“åº”çš„èŠå¤©å†…å®¹)
- [x] æ”¯æŒé»˜è®¤openai api key(å¤šapi key å¾ªç¯è°ƒç”¨)
- [x] è½¬å‘api key (åœ¨å·²è®¾ç½®é»˜è®¤openai api keyæƒ…å†µä¸‹ä½¿ç”¨)
- [x] dockeréƒ¨ç½²
- [x] æ”¯æŒæŒ‡å®šè½¬å‘è·¯ç”±å‰ç¼€
- [x] æ”¯æŒè¯·æ±‚IPéªŒè¯

# åº”ç”¨

> è¿™é‡Œä»¥ä¸ªäººä½¿ç”¨è¯¥é¡¹ç›®æ­å»ºå¥½çš„ä»£ç†æœåŠ¡ https://caloi.top/openai ä¸ºä¾‹

### [caloi.top](https://caloi.top)

åŸºäºå¼€æºé¡¹ç›®[ChatGPT-Next-Web](https://github.com/Yidadaa/ChatGPT-Next-Web)æ­å»ºè‡ªå·±çš„chatgptæœåŠ¡  
æ›¿æ¢dockerå¯åŠ¨å‘½ä»¤ä¸­çš„ `BASE_URL`ä¸ºæˆ‘ä»¬è‡ªå·±æ­å»ºçš„ä»£ç†æœåŠ¡åœ°å€

```bash 
docker run -d \
    -p 3000:3000 \
    -e OPENAI_API_KEY="sk-******" \
    -e BASE_URL="caloi.top/openai" \
    -e CODE="<your password>" \
    yidadaa/chatgpt-next-web 
``` 

è®¿é—® https://caloi.top ã€‚è®¿é—®å¯†ç ä¸º `beidongjiedeguang`

### åœ¨æ¨¡å—ä¸­ä½¿ç”¨

**JS/TS**

```diff
  import { Configuration } from "openai";
  
  const configuration = new Configuration({
+ basePath: "https://caloi.top/openai/v1",
  apiKey: "sk-******",
  });
```

**Python**

```diff
  import openai
+ openai.api_base = "https://caloi.top/openai/v1"
  openai.api_key = "sk-******"
```

### Image Generation (DALL-E):

```bash
curl --location 'https://caloi.top/openai/v1/images/generations' \
--header 'Authorization: Bearer sk-******' \
--header 'Content-Type: application/json' \
--data '{
    "prompt": "A photo of a cat",
    "n": 1,
    "size": "512x512"
}'
```

# å®‰è£…éƒ¨ç½²

æä¾›3ç§æœåŠ¡éƒ¨ç½²æ–¹å¼,é€‰æ‹©ä¸€ç§å³å¯

## pip
pipçš„å®‰è£…æ–¹å¼ç›®å‰åœ¨ä½¿ç”¨nginxåå‘ä»£ç†æ—¶å­˜åœ¨Bug, å»ºè®®ä½¿ç”¨Dockeræ–¹å¼éƒ¨ç½²ã€‚  
**å®‰è£…**

```bash
pip install openai-forward
```

**è¿è¡Œè½¬å‘æœåŠ¡**  
å¯é€šè¿‡`--port`æŒ‡å®šç«¯å£å·ï¼Œé»˜è®¤ä¸º`8000`ï¼Œå¯é€šè¿‡`--workers`æŒ‡å®šå·¥ä½œè¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º`1`

```bash
openai_forward run --port=9999 --workers=1
```

æœåŠ¡å°±æ­å»ºå®Œæˆäº†ï¼Œä½¿ç”¨æ–¹å¼åªéœ€å°†`https://api.openai.com` æ›¿æ¢ä¸ºæœåŠ¡æ‰€åœ¨ç«¯å£`http://{ip}:{port}` å³å¯ã€‚

å½“ç„¶ä¹Ÿå¯ä»¥å°† OPENAI_API_KEY ä½œä¸ºç¯å¢ƒå˜é‡ä¼ å…¥ä½œä¸ºé»˜è®¤api keyï¼Œ è¿™æ ·å®¢æˆ·ç«¯åœ¨è¯·æ±‚ç›¸å…³è·¯ç”±æ—¶å¯ä»¥æ— éœ€åœ¨Headerä¸­ä¼ å…¥Authorizationã€‚
å¸¦é»˜è®¤api keyçš„å¯åŠ¨æ–¹å¼ï¼š

```bash
OPENAI_API_KEY="sk-xxx" openai_forward run --port=9999 --workers=1
```

æ³¨: å¦‚æœæ—¢å­˜åœ¨é»˜è®¤api keyåˆåœ¨è¯·æ±‚å¤´ä¸­ä¼ å…¥äº†api keyï¼Œåˆ™ä»¥è¯·æ±‚å¤´ä¸­çš„api keyä¼šè¦†ç›–é»˜è®¤api key.

## Docker (æ¨è)

```bash
docker run --name="openai-forward" -d -p 9999:8000 beidongjiedeguang/openai-forward:latest 
```

å°†æ˜ å°„å®¿ä¸»æœºçš„9999ç«¯å£ï¼Œé€šè¿‡`http://{ip}:9999`è®¿é—®æœåŠ¡ã€‚  
æ³¨ï¼šåŒæ ·å¯ä»¥åœ¨å¯åŠ¨å‘½ä»¤ä¸­é€šè¿‡-eä¼ å…¥ç¯å¢ƒå˜é‡OPENAI_API_KEY=sk-xxxä½œä¸ºé»˜è®¤api key

## æºç éƒ¨ç½²

```bash
git clone https://github.com/beidongjiedeguang/openai-forward.git --depth=1
cd openai-forward
```

**ä½¿ç”¨ docker**

```bash
docker-compose up
```

**æˆ–ä½¿ç”¨pip**

```bash
pip install -e .
openai-forward run 
```

# æœåŠ¡è°ƒç”¨

æ›¿æ¢openaiçš„apiåœ°å€ä¸ºè¯¥æœåŠ¡çš„åœ°å€å³å¯ï¼Œå¦‚ï¼š

```bash
https://api.openai.com/v1/chat/completions
```

æ›¿æ¢ä¸º

```bash
http://{ip}:{port}/v1/chat/completions
```

# é…ç½®é€‰é¡¹

**`openai-forward run`å‚æ•°é…ç½®é¡¹**

| é…ç½®é¡¹       | è¯´æ˜ | é»˜è®¤å€¼ |
|-----------| --- | :---: |
| --port    | æœåŠ¡ç«¯å£å· | 8000 |
| --workers | å·¥ä½œè¿›ç¨‹æ•° | 1 |

**ç¯å¢ƒå˜é‡é…ç½®é¡¹**  
å‚è€ƒé¡¹ç›®æ ¹ç›®å½•ä¸‹`.env`æ–‡ä»¶

| ç¯å¢ƒå˜é‡            | è¯´æ˜                                                              |           é»˜è®¤å€¼            |
|-----------------|-----------------------------------------------------------------|:------------------------:|
| OPENAI_API_KEY  | é»˜è®¤openai api keyï¼Œæ”¯æŒå¤šä¸ªé»˜è®¤api key, ä»¥ `sk-` å¼€å¤´ï¼Œ ä»¥ç©ºæ ¼åˆ†å‰²      |            æ—              |
| FORWARD_KEY     | å…è®¸è°ƒç”¨æ–¹ä½¿ç”¨è¯¥keyä»£æ›¿openai api keyï¼Œæ”¯æŒå¤šä¸ªforward key, ä»¥`fk-` å¼€å¤´, ä»¥ç©ºæ ¼åˆ†å‰² |      æ—              |
| OPENAI_BASE_URL | è½¬å‘base url                                                      | `https://api.openai.com` |
| LOG_CHAT        | æ˜¯å¦è®°å½•èŠå¤©å†…å®¹                                                        |          `true`          |
| ROUTE_PREFIX    | è·¯ç”±å‰ç¼€                                                            |            æ—              |
| IP_WHITELIST    | ipç™½åå•, ç©ºæ ¼åˆ†å¼€                                                     |           æ—             |
| IP_BLACKLIST    | ipé»‘åå•, ç©ºæ ¼åˆ†å¼€                                                     |           æ—             | 

# èŠå¤©æ—¥å¿—

ä¿å­˜è·¯å¾„åœ¨å½“å‰ç›®å½•ä¸‹çš„`Log/`è·¯å¾„ä¸­ã€‚  
èŠå¤©æ—¥å¿—ä»¥ `chat_`å¼€å¤´, é»˜è®¤æ¯5è½®å¯¹è¯å†™å…¥ä¸€æ¬¡æ–‡ä»¶    
è®°å½•æ ¼å¼ä¸º

```text
{'host': xxx, 'model': xxx, 'message': [{'user': xxx}, {'assistant': xxx}]}
{'assistant': xxx}

{'host': ...}
{'assistant': ...}

...
```

# é«˜çº§é…ç½®

**è®¾ç½®api_keyä¸ºè‡ªå·±è®¾ç½®çš„forward key**  
éœ€è¦é…ç½® OPENAI_API_KEY å’Œ FORWARD_KEY, ä¾‹å¦‚

```bash
OPENAI_API_KEY=sk-*******
FORWARD_KEY=fk-****** # è¿™é‡Œfk-tokenç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰
```
è¿™é‡Œæˆ‘ä»¬é…ç½®äº†FORWARD_KEYä¸º`fk-******`, é‚£ä¹ˆåé¢å®¢æˆ·ç«¯åœ¨è°ƒç”¨æ—¶åªéœ€è®¾ç½®OPENAI_API_KEYä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„`fk-******` å³å¯ã€‚  
è¿™æ ·çš„å¥½å¤„æ˜¯åœ¨ä½¿ç”¨ä¸€äº›éœ€è¦è¾“å…¥OPENAI_API_KEYçš„ç¬¬ä¸‰æ–¹åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`fk-******`æ­é…proxyä½¿ç”¨ï¼ˆå¦‚ä¸‹é¢çš„ä¾‹å­ï¼‰ è€Œæ— éœ€æ‹…å¿ƒOPENAI_API_KEYè¢«æ³„éœ²ã€‚

**ç”¨ä¾‹:**
```bash
curl https://caloi.top/openai/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer fk-******" \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```
**Python**
```diff
  import openai
+ openai.api_base = "https://caloi.top/openai/v1"
- openai.api_key = "sk-******"
+ openai.api_key = "fk-******"
```
**Web application**
```bash 
docker run -d \
    -p 3000:3000 \
    -e OPENAI_API_KEY="fk-******" \
    -e BASE_URL="caloi.top/openai" \
    -e CODE="<your password>" \
    yidadaa/chatgpt-next-web 
``` 