import{s as A}from"./vue-virtual-scroller.esm-60e1261b.js";/* empty css                             */import{i as G,j as H,K as Z,r as u,c as k,w as I,o as J,d as O,l as m,B as g,f as i,y as V,q as n,F as P,D as T,n as b,A as _,s as v,C as $,m as Q,v as L,z as R,x as W,Z as X}from"./index-4822884e.js";import{_ as Y}from"./ListviewItem.vue_vue_type_style_index_0_lang-8c038c80.js";import{_ as z,a as ee}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-fffa51b4.js";import{V as te,a as ae,b as le}from"./VSelect-75f2de4e.js";import{V as se,a as re}from"./VRow-10f2ac9b.js";import{V as oe}from"./VSpacer-c3517420.js";import{V as ie}from"./VTooltip-c3262e6e.js";import{V as ue,n as ne}from"./VBtn-100eb5c9.js";import{V as me}from"./VToolbar-1a1dbef8.js";import"./utils-9ffe70c1.js";import"./VCardText-4f782ffb.js";import"./_plugin-vue_export-helper-c1ceac95.js";import"./ProviderIcon.vue_vue_type_script_setup_true_lang-aa9d38b8.js";import"./VCard-8d6cfe56.js";import"./forwardRefs-29398c77.js";import"./VDivider-ef9e8070.js";import"./VMenu-5ed60cfc.js";import"./VLabel-04e3b220.js";import"./VCheckboxBtn-48908431.js";import"./VDialog-057042a1.js";/* empty css              */const ve={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},de={key:2},fe={style:{"margin-left":"15px"}},Ne=G({__name:"Search",props:{initSearch:null},setup(D){const C=D,N=H(),{mobile:U}=Z(),s=u("list"),y=u(0),r=u(""),d=u(!1),l=u(),w=u(!1),f=u(!1),p=u([]),x=u(),B=["topresult","artists","albums","tracks","playlists","radios"],E=k(()=>U.value?140:150),K=function(){s.value==="panel"?s.value="list":s.value="panel",localStorage.setItem(`viewMode.search.${o.value}`,s.value)},M=function(e){p.value=[e],f.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=L.selectedPlayer)!=null&&t.available)?N.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):L.selectedPlayer&&R.playMedia(e)};I(()=>r.value,()=>{clearTimeout(x.value),x.value=setTimeout(()=>{q()},200)});const j=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},q=async function(){w.value=!0,localStorage.setItem("globalsearch",r.value),r.value?l.value=await R.search(r.value):l.value=void 0,w.value=!1},o=k(()=>B[y.value]),c=k(()=>{if(!l.value)return[];if(o.value=="artists")return l.value.artists;if(o.value=="albums")return l.value.albums;if(o.value=="tracks")return l.value.tracks;if(o.value=="playlists")return l.value.playlists;if(o.value=="radios")return l.value.radio;if(o.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const h of t)a.includes(h.provider)||(e.push(h),a.push(h.provider))}return e}return[]});I(()=>o.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${o.value}`);t?s.value=t:o.value=="artists"||o.value=="albums"?s.value="panel":s.value="list"}},{immediate:!0}),J(()=>{if(C.initSearch)r.value=C.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(r.value=e)}});const S=function(e){f.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),p.value=c.value):!d.value&&e.key=="Backspace"?r.value=r.value.slice(0,-1):!d.value&&e.key.length==1&&(r.value+=e.key))};return document.addEventListener("keydown",S),O(()=>{document.removeEventListener("keydown",S)}),(e,t)=>(m(),g("div",null,[i(te,{id:"searchInput",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>d.value=!0),onBlur:t[2]||(t[2]=a=>d.value=!1)},null,8,["modelValue","label"]),V("div",null,[i(ae,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(m(),g(P,null,T(B,a=>i(le,{key:a,filter:"",outlined:""},{default:n(()=>[W($(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),i(z,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),items:p.value,onClear:t[5]||(t[5]=()=>{p.value=[]})},null,8,["modelValue","items"]),V("div",ve,[w.value?(m(),b(ne,{key:0,indeterminate:""})):_("",!0),s.value=="panel"?(m(),b(se,{key:1},{default:n(()=>[(m(!0),g(P,null,T(v(c),a=>(m(),b(re,{key:a.uri,class:X(`col-${j(e.$vuetify.display.width)}`)},{default:n(()=>[i(ee,{item:a,size:v(E),"is-selected":!1,"show-checkboxes":!1,onMenu:M,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),s.value=="list"?(m(),g("div",de,[i(v(A),{items:v(c),"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[i(Y,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:M,onClick:F},null,8,["item"])]),_:1},8,["items"])])):_("",!0)]),i(me,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[V("span",fe,$(e.$t("items_total",[v(c).length])),1),i(oe),i(ie,{location:"bottom"},{activator:n(({props:a})=>[i(ue,Q(a,{icon:s.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=h=>K())}),null,16,["icon"])]),default:n(()=>[V("span",null,$(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]))}});export{Ne as default};
