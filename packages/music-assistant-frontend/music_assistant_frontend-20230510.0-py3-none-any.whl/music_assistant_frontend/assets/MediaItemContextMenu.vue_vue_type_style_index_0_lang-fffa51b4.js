import{i as Q,c as W,l as s,n as f,q as o,f as n,B as y,am as H,A as b,s as v,V as ae,y as _,m as ie,C as g,x as E,an as T,k as ne,r as x,w as oe,v as L,z as u,D as M,F as B,ao as I,P as k,a1 as G,ap as se,X as w}from"./index-4822884e.js";import{_ as J,p as re,b as ue}from"./utils-9ffe70c1.js";import{a as de}from"./_plugin-vue_export-helper-c1ceac95.js";import{V as ce,P as pe}from"./ListviewItem.vue_vue_type_style_index_0_lang-8c038c80.js";import{V as me}from"./VTooltip-c3262e6e.js";import{b as U,V as O}from"./VBtn-100eb5c9.js";import{V as $,e as z,d as R,a as X}from"./VCardText-4f782ffb.js";import{a as Z}from"./VCard-8d6cfe56.js";import{_ as ye}from"./ProviderIcon.vue_vue_type_script_setup_true_lang-aa9d38b8.js";import{V as fe,b as j}from"./VToolbar-1a1dbef8.js";import{c as be,V as ve}from"./VSelect-75f2de4e.js";import{V as D}from"./forwardRefs-29398c77.js";import{V as ge}from"./VDialog-057042a1.js";import{V as F}from"./VDivider-ef9e8070.js";const he={key:0,style:{position:"absolute",top:"0","background-color":"#82b1ff94",height:"50px"}},_e=["src"],ke={class:"font-weight-bold line-clamp-1",style:{color:"primary","margin-top":"8px","margin-bottom":"8px"}},Ae={key:2,style:{"margin-bottom":"8px","font-size":"x-small"}},qe=Q({__name:"PanelviewItem",props:{item:null,size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1}},emits:["menu","click","select"],setup(e,{emit:i}){const t=e,d=W(()=>{for(const c of t.item.provider_mappings)if(c.content_type!=null&&c.content_type in[T.DSF,T.FLAC,T.AIFF,T.WAV]&&(c.sample_rate>48e3||c.bit_depth>16))return`${c.sample_rate}kHz ${c.bit_depth} bits`;return""});return(c,m)=>(s(),f(Z,{outlined:"",style:{height:"100%"},onClick:m[2]||(m[2]=h=>i("click",e.item)),onContextmenu:m[3]||(m[3]=H(h=>i("menu",e.item),["right","prevent"]))},{default:o(()=>[n(J,{item:e.item,width:"100%"},null,8,["item"]),e.showCheckboxes?(s(),y("div",he,[n(ce,{"model-value":e.isSelected,onClick:m[0]||(m[0]=H(()=>{},["stop"])),"onUpdate:modelValue":m[1]||(m[1]=h=>{i("select",e.item,h)})},null,8,["model-value"])])):b("",!0),v(d)?(s(),y("div",{key:1,class:"hiresicon",style:ae(c.$vuetify.theme.current.dark?"background-color: black":"background-color:white")},[n(me,{bottom:""},{activator:o(({props:h})=>[_("img",ie({src:v(de),height:"35"},h,{style:c.$vuetify.theme.current.dark?"object-fit: contain;":"object-fit: contain;filter: invert(100%);"}),null,16,_e)]),default:o(()=>[_("span",null,g(v(d)),1)]),_:1})],4)):b("",!0),v(re)(e.item.metadata.explicit||!1)?(s(),f(U,{key:2,icon:"mdi-alpha-e-box",size:"30",style:{position:"absolute",right:"2px",top:"2px",height:"30px",width:"30px","background-color":"black"}})):b("",!0),n($,{"two-line":"",style:{"padding-left":"8px","padding-right":"8px"}},{default:o(()=>[_("div",null,[_("p",ke,g(e.item.name),1)]),"artists"in e.item&&e.item.artists?(s(),f(z,{key:0,class:"line-clamp-2",style:{"margin-bottom":"8px"}},{default:o(()=>[E(g(v(ue)(e.item.artists)),1)]),_:1})):"owner"in e.item&&e.item.owner?(s(),f(z,{key:1,class:"line-clamp-2",style:{"margin-bottom":"8px"}},{default:o(()=>[E(g(e.item.owner),1)]),_:1})):b("",!0),"version"in e.item&&e.item.version?(s(),y("span",Ae,g(e.item.version),1)):b("",!0)]),_:1})]),_:1}))}}),Ve={key:0},xe={class:"listitem-thumb"},Ce={class:"listitem-actions"},Pe={key:0},C=function(e){var i;for(const t of e.provider_mappings)if(t.available&&((i=u.providers[t.provider_instance])!=null&&i.available))return!0;return!1},Ie=function(e){var i;for(const t of e.provider_mappings)if((i=u.providers[t.provider_instance])!=null&&i.supported_features.includes(G.SIMILAR_TRACKS))return!0;return!1},we=function(e,i){const t=[];if(e.length==0||!C(e[0]))return t;let d=I.PLAY,c=I.NEXT;return(e.length>10||[k.ALBUM,k.PLAYLIST].includes(e[0].media_type))&&(d=I.REPLACE,c=I.REPLACE_NEXT),e.length==1&&i&&i.media_type==k.PLAYLIST&&t.push({label:"play_playlist_from",action:()=>{u.playPlaylistFromIndex(i,e[0].position||0)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length==1&&i&&i.media_type==k.ALBUM&&t.push({label:"play_album_from",action:()=>{u.playAlbumFromItem(i,e[0])},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),t.push({label:"play_now",action:()=>{u.playMedia(e,d)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),Ie(e[0])&&t.push({label:"play_radio",action:()=>{u.playMedia(e,d,!0)},icon:"mdi-radio-tower",labelArgs:[],actionStr:"play"}),(e.length===1||e[0].media_type===k.TRACK)&&t.push({label:"play_next",action:()=>{u.playMedia(e,c)},icon:"mdi-skip-next-circle-outline",labelArgs:[],actionStr:"play"}),t.push({label:"add_queue",action:()=>{u.playMedia(e,I.ADD)},icon:"mdi-playlist-plus",labelArgs:[],actionStr:"play"}),t},$e=function(e,i){const t=[];if(e.length==0)return t;if(e.length===1&&e[0]!==i&&C(e[0])&&t.push({label:"show_info",labelArgs:[],action:()=>{var d;w.push({name:e[0].media_type,params:{itemId:e[0].item_id,provider:e[0].provider},query:{album:"album"in e[0]?(d=e[0].album)==null?void 0:d.uri:""}})},icon:"mdi-information-outline"}),e.length===1&&C(e[0])&&"artists"in e[0]&&e[0].artists.length===1)for(const d of e[0].artists)t.push({label:"goto_artist",labelArgs:[d.name],action:()=>{w.push({name:"artist",params:{itemId:d.item_id,provider:d.provider}})},icon:"mdi-account-music"});if(e.length===1&&C(e[0])&&"album"in e[0]&&e[0].album&&t.push({label:"goto_album",labelArgs:[e[0].album.name],action:()=>{w.push({name:"album",params:{itemId:e[0].album.item_id,provider:e[0].album.provider}})},icon:"mdi-album"}),e.length===1&&(e[0]==i||!C(e[0]))&&t.push({label:"refresh_item",labelArgs:[],action:async()=>{await u.refreshItem(e[0]),w.go(0)},icon:"mdi-refresh"}),!e[0].in_library&&C(e[0])&&t.push({label:"add_library",labelArgs:[],action:()=>{u.addItemsToLibrary(e)},icon:"mdi-heart-outline"}),e[0].in_library&&t.push({label:"remove_library",labelArgs:[],action:()=>{u.removeItemsFromLibrary(e)},icon:"mdi-heart"}),i&&i.media_type===k.PLAYLIST){const d=i;e[0].media_type===k.TRACK&&d.is_editable&&t.push({label:"remove_playlist",labelArgs:[],action:()=>{u.removePlaylistTracks(d.item_id,e.map(c=>c.position))},icon:"mdi-minus-circle-outline"})}return e[0].media_type==="track"&&t.push({label:"add_playlist",labelArgs:[],actionStr:"add_playlist",icon:"mdi-plus-circle-outline"}),e.length==1&&e[0].provider=="database"&&t.push({label:"delete_db",labelArgs:[],action:()=>{u.deleteDbItem(e[0].media_type,e[0].item_id,!0),i&&i.item_id==e[0].item_id&&w.push({name:`${i.media_type}s`})},icon:"mdi-cancel"}),e.length>1&&t.push({label:"clear_selection",labelArgs:[],actionStr:"clear",icon:"mdi-cancel"}),t},He=Q({__name:"MediaItemContextMenu",props:{items:null,parentItem:{default:void 0},modelValue:{type:Boolean},enablePlayItems:{type:Boolean,default:!0},enableActionMenuItems:{type:Boolean,default:!0},fullscreen:{type:Boolean,default:!0}},emits:["refresh","clear","update:modelValue","update:items"],setup(e,{emit:i}){const t=e,{t:d}=ne(),c=x([]),m=x([]),h=x(""),S=x([]),A=x(!1),N=x("");oe(()=>t.modelValue,l=>{l&&ee()});const ee=async function(){if(A.value=!1,S.value=[],!t.items)return;t.items.length===1?h.value=t.items[0].name:h.value=d("items_selected",[t.items.length]).toString(),L.selectedPlayer&&L.selectedPlayer.available?m.value=we(t.items,t.parentItem):m.value=[];let l=t.items[0],r=0;if("position"in l&&(r=l.position),l.provider!=="database"){try{l=await u.getItemByUri(t.items[0].uri)}catch{l=t.items[0]}"position"in l&&(l.position=r);const a=t.items;a[0]=l,i("update:items",a)}c.value=$e(t.items,t.parentItem),te()},te=async function(){S.value=[];const l=await u.getPlaylists();for(const r of l.items)r.is_editable&&!(t.parentItem&&t.parentItem.media_type===k.PLAYLIST&&r.item_id===t.parentItem.item_id)&&S.value.push(r)},K=function(l){u.addPlaylistTracks(l.item_id,t.items.map(r=>r.uri)),P()},Y=async function(l){const r=await u.createPlaylist(N.value,l);K(r)},q=async function(l){l.actionStr=="add_playlist"?A.value=!0:l.actionStr=="clear"?(i("clear"),P()):l.action&&l.actionStr=="play"?(l.action(),i("clear"),P()):l.action&&(P(),l.action())},P=function(){t.items.length==1&&i("clear"),i("update:modelValue",!1)},le=W(()=>{var r,a;const l=[];for(const p in(r=u)==null?void 0:r.players){const V=(a=u)==null?void 0:a.players[p];V.synced_to||l.push({title:V.display_name,value:V.player_id})}return l.slice().sort((p,V)=>p.title.toUpperCase()>V.title.toUpperCase()?1:-1)});return(l,r)=>(s(),f(ge,{"model-value":e.modelValue,fullscreen:l.$vuetify.display.mobile,"min-height":"80%",scrim:!0,"onUpdate:modelValue":r[3]||(r[3]=a=>l.$emit("update:modelValue",a))},{default:o(()=>[n(Z,null,{default:o(()=>[n(fe,{dark:""},{default:o(()=>[n(O,{icon:"mdi-play-circle-outline"}),A.value?(s(),f(j,{key:0,style:{"padding-left":"10px"}},{default:o(()=>[_("b",null,g(l.$t("add_playlist")),1),l.$vuetify.display.mobile?b("",!0):(s(),y("span",Ve," | "+g(h.value),1))]),_:1})):(s(),f(j,{key:1,style:{"padding-left":"10px"}},{default:o(()=>[_("b",null,g(h.value),1)]),_:1})),n(O,{icon:"mdi-close",dark:"",onClick:r[0]||(r[0]=a=>P())})]),_:1}),e.enablePlayItems&&!A.value&&m.value.length>0?(s(),f(R,{key:0},{default:o(()=>{var a;return[n(be,{label:l.$t("play_on"),"model-value":(a=v(L).selectedPlayer)==null?void 0:a.player_id,items:v(le),"hide-details":"","onUpdate:modelValue":r[1]||(r[1]=p=>{v(L).selectedPlayer=v(u).players[p]})},null,8,["label","model-value","items"]),n(D,null,{default:o(()=>[(s(!0),y(B,null,M(m.value,p=>(s(),y("div",{key:p.label},[n($,{title:l.$t(p.label,p.labelArgs),density:"default",onClick:V=>q(p)},{prepend:o(()=>[n(X,{style:{"padding-right":"10px"}},{default:o(()=>[n(U,{icon:p.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"]),n(F)]))),128))]),_:1})]}),_:1})):b("",!0),e.enableActionMenuItems&&!A.value&&c.value.length>0?(s(),f(R,{key:1,style:{"padding-top":"0","margin-top":"-10px","padding-bottom":"0"}},{default:o(()=>[n(z,{style:{"margin-left":"10px"}},{default:o(()=>[E(g(l.$t("actions")),1)]),_:1}),n(D,null,{default:o(()=>[(s(!0),y(B,null,M(c.value,a=>(s(),y("div",{key:a.label},[n($,{title:l.$t(a.label,a.labelArgs),density:"default",onClick:p=>q(a)},{prepend:o(()=>[n(X,{style:{"padding-right":"10px"}},{default:o(()=>[n(U,{icon:a.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"]),n(F)]))),128))]),_:1})]),_:1})):b("",!0),A.value?(s(),f(R,{key:2},{default:o(()=>[n(D,null,{default:o(()=>[(s(!0),y(B,null,M(S.value,a=>(s(),y("div",{key:a.item_id},[n($,{ripple:"",density:"default",onClick:p=>K(a)},{prepend:o(()=>[_("div",xe,[n(J,{item:a,size:50,width:"50px",height:"50px"},null,8,["item"])])]),title:o(()=>[_("div",null,g(a.name),1)]),subtitle:o(()=>[_("div",null,g(a.owner),1)]),append:o(()=>[_("div",Ce,[a.provider_mappings?(s(),f(pe,{key:0,"provider-mappings":a.provider_mappings,height:20,class:"listitem-actions"},null,8,["provider-mappings"])):b("",!0)])]),_:2},1032,["onClick"]),n(F)]))),128)),(s(!0),y(B,null,M(v(u).providers,a=>(s(),y("div",{key:a.instance_id},[a.supported_features.includes(v(G).PLAYLIST_CREATE)?(s(),y("div",Pe,[n($,{ripple:""},{prepend:o(()=>[n(ye,{domain:a.domain,size:"40px",class:"listitem-thumb"},null,8,["domain"])]),title:o(()=>[n(ve,{label:l.$t("create_playlist",[a.name]),"append-icon":"mdi-playlist-plus",variant:"plain","hide-details":"","onUpdate:modelValue":r[2]||(r[2]=p=>{N.value=p}),"onClick:append":p=>Y(a.instance_id),onKeydown:se(p=>Y(a.instance_id),["enter"])},null,8,["label","onClick:append","onKeydown"])]),_:2},1024),n(F)])):b("",!0)]))),128))]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["model-value","fullscreen"]))}});export{He as _,qe as a,$e as b,we as g,C as i};
