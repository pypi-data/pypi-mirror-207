
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>stdcomQtC20 &#8212; stdcomQt 1.1.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for stdcomQtC20</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is where Stec misc control objects are kept</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExpFilter"><a class="viewcode-back" href="../code.html#stdcomQtC20.ExpFilter">[docs]</a><span class="k">class</span> <span class="nc">ExpFilter</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exponetial filter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FI</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">FV</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FI</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">.20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .01 to 1 where 1 in no filter</span>
<span class="sd">        default is .2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FV</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FI</span> <span class="o">=</span> <span class="n">FI</span>

<div class="viewcode-block" id="ExpFilter.Reset"><a class="viewcode-back" href="../code.html#stdcomQtC20.ExpFilter.Reset">[docs]</a>    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clean out history</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ExpFilter.XtoC"><a class="viewcode-back" href="../code.html#stdcomQtC20.ExpFilter.XtoC">[docs]</a>    <span class="k">def</span> <span class="nf">XtoC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        in with value return filtered value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FV</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FV</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FV</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">FI</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span> <span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">FI</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FV</span></div>

<div class="viewcode-block" id="ExpFilter.SetFI"><a class="viewcode-back" href="../code.html#stdcomQtC20.ExpFilter.SetFI">[docs]</a>    <span class="k">def</span> <span class="nf">SetFI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FI</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets to new FI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FI</span> <span class="o">=</span> <span class="n">FI</span></div></div>

<div class="viewcode-block" id="RollingAverageFilter"><a class="viewcode-back" href="../code.html#stdcomQtC20.RollingAverageFilter">[docs]</a><span class="k">class</span> <span class="nc">RollingAverageFilter</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rolling average filter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nbrSamples</span><span class="o">=</span><span class="mi">5</span>
    <span class="n">Samples</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbrSamples</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        number of samples to use for filter</span>
<span class="sd">        default is 5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbrSamples</span> <span class="o">=</span> <span class="n">nbrSamples</span>

<div class="viewcode-block" id="RollingAverageFilter.Reset"><a class="viewcode-back" href="../code.html#stdcomQtC20.RollingAverageFilter.Reset">[docs]</a>    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clears history</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">XtoC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Samples</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbrSamples</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="p">)</span>  <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>

        <span class="n">FV</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Samples</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FV</span></div>


<div class="viewcode-block" id="Dahlin"><a class="viewcode-back" href="../code.html#stdcomQtC20.Dahlin">[docs]</a><span class="k">class</span> <span class="nc">Dahlin</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    simple Dahlin controller, if you don&#39;t like the PID controller</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">TC</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">LAMBDA</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Em1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">then</span> <span class="o">=</span> <span class="n">now</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TC</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span> <span class="n">LAMBDA</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">GAIN</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">GAIN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="n">TC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LAMBDA</span> <span class="o">=</span> <span class="n">LAMBDA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Em1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">then</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Dahlin.Reset"><a class="viewcode-back" href="../code.html#stdcomQtC20.Dahlin.Reset">[docs]</a>    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clears history</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Em1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Dahlin.XtoC"><a class="viewcode-back" href="../code.html#stdcomQtC20.Dahlin.XtoC">[docs]</a>    <span class="k">def</span> <span class="nf">XtoC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="nb">float</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        in with error from 0, where 0 is the target,</span>
<span class="sd">        return controller output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">then</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Seconds&quot;</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">.0001</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">then</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span>

        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">T</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="p">)</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
        <span class="n">En</span> <span class="o">=</span> <span class="n">X</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">K</span> <span class="o">*</span> <span class="p">(</span> <span class="n">En</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Em1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Em1</span> <span class="o">=</span> <span class="n">En</span>
        <span class="k">return</span> <span class="n">X</span></div>

    <span class="k">def</span> <span class="nf">Time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span></div>



<div class="viewcode-block" id="twiddle"><a class="viewcode-back" href="../code.html#stdcomQtC20.twiddle">[docs]</a><span class="k">def</span> <span class="nf">twiddle</span><span class="p">(</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">error_cmp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A coordinate descent parameter tuning algorithm.</span>

<span class="sd">    https://en.wikipedia.org/wiki/Coordinate_descent</span>

<span class="sd">    Params:</span>

<span class="sd">        evaluator := callable that will be passed a series of number parameters, which will return</span>
<span class="sd">            an error measure</span>

<span class="sd">        tol := tolerance threshold, the smaller the value, the greater the tuning</span>

<span class="sd">        params := the number of parameters to tune</span>

<span class="sd">        error_cmp := a callable that takes two error measures (the current and last best)</span>
<span class="sd">            and returns true if the first is less than the second</span>

<span class="sd">        initial_guess := parameters to begin tuning with</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_error_cmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># Returns true if a is closer to zero than b.</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">error_cmp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">error_cmp</span> <span class="o">=</span> <span class="n">_error_cmp</span>

    <span class="k">if</span> <span class="n">initial_guess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_guess</span><span class="p">)</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span>
    <span class="n">best_err</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;steps:&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="s1">&#39;tol:&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="s1">&#39;best error:&#39;</span><span class="p">,</span> <span class="n">best_err</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

            <span class="c1"># first try to increase param</span>
            <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">error_cmp</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">best_err</span><span class="p">):</span>
                <span class="c1"># Increasing param reduced error, so record and continue to increase dp range.</span>
                <span class="n">best_err</span> <span class="o">=</span> <span class="n">err</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Otherwise, increased error, so undo and try decreasing dp</span>
                <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">error_cmp</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">best_err</span><span class="p">):</span>
                    <span class="c1"># Decreasing param reduced error, so record and continue to increase dp range.</span>
                    <span class="n">best_err</span> <span class="o">=</span> <span class="n">err</span>
                    <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.1</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Otherwise, reset param and reduce dp range.</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.9</span>

    <span class="k">return</span> <span class="n">p</span></div>


<div class="viewcode-block" id="PID"><a class="viewcode-back" href="../code.html#stdcomQtC20.PID">[docs]</a><span class="k">class</span> <span class="nc">PID</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple PID control.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;get_time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span>

        <span class="c1"># initialze gains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span> <span class="o">=</span> <span class="n">d</span>

        <span class="c1"># The value the controller is trying to get the system to achieve.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># initialize delta t variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_feedback</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize delta t variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_feedback</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span>

    <span class="nd">@target</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedback</span><span class="p">,</span> <span class="n">curr_tm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Performs a PID computation and returns a control value.</span>

<span class="sd">            This is based on the elapsed time (dt) and the current value of the process variable</span>
<span class="sd">            (i.e. the thing we&#39;re measuring and trying to change).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calculate error.</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">-</span> <span class="n">feedback</span>

        <span class="c1"># Calculate time differential.</span>
        <span class="k">if</span> <span class="n">curr_tm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curr_tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">curr_tm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_tm</span>

        <span class="c1"># Initialize output variable.</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Add proportional component.</span>
        <span class="n">alpha</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span> <span class="o">*</span> <span class="n">error</span>

        <span class="c1"># Add integral component.</span>
        <span class="n">alpha</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

        <span class="c1"># Add differential component (avoiding divide-by-zero).</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span> <span class="o">*</span> <span class="p">((</span><span class="n">feedback</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_feedback</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

        <span class="c1"># Maintain memory for next loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_tm</span> <span class="o">=</span> <span class="n">curr_tm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_feedback</span> <span class="o">=</span> <span class="n">feedback</span>
        <span class="k">return</span> <span class="n">alpha</span></div>


<div class="viewcode-block" id="ComputerSL"><a class="viewcode-back" href="../code.html#stdcomQtC20.ComputerSL">[docs]</a><span class="k">class</span> <span class="nc">ComputerSL</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    computers the slope and intercept for interpolation of history array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span><span class="n">Y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y2</span> <span class="o">-</span> <span class="n">Y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">X2</span> <span class="o">-</span> <span class="n">X1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span>  <span class="n">Y1</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">X1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>

        <span class="k">return</span> <span class="n">c</span></div>


<div class="viewcode-block" id="HistoryDelay"><a class="viewcode-back" href="../code.html#stdcomQtC20.HistoryDelay">[docs]</a><span class="k">class</span> <span class="nc">HistoryDelay</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a history array, it will work with either number storage IE steps, or if tau is not None, then it will work off of Tau</span>
<span class="sd">    It is meant as to not store more than necessary if tau is given.. if steps are used, then storage will be in steps and the use must ensure</span>
<span class="sd">    then number of steps is suffecient to store what is needed.</span>
<span class="sd">    No Block rate is needed, this works of actual seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">historyLimit</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">tau</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historyLimit</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>

    <span class="k">def</span> <span class="nf">Insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">tm</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pair</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">historyLimit</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span>  <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">))</span> <span class="p">:</span>
                <span class="n">tm1</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">tm</span> <span class="o">-</span> <span class="n">tm1</span>
                <span class="k">if</span> <span class="n">df1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="p">:</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">-</span> <span class="n">i2</span> <span class="p">:</span> <span class="p">]</span>
                    <span class="k">return</span>


    <span class="k">def</span> <span class="nf">ComputeSumToPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span>  <span class="n">multi</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">))</span> <span class="p">:</span>

            <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tm</span> <span class="o">-</span> <span class="n">t</span>

            <span class="k">if</span> <span class="n">df</span> <span class="o">&lt;=</span> <span class="n">seconds</span> <span class="p">:</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">multi</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="p">:</span>

                    <span class="n">t1</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span>
                    <span class="n">df1</span> <span class="o">=</span> <span class="n">tm</span> <span class="o">-</span> <span class="n">t1</span>

                    <span class="n">nv</span>  <span class="o">=</span> <span class="n">ComputerSL</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">v1</span><span class="p">)</span>
                    <span class="n">computedV</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
                    <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="p">(</span> <span class="n">computedV</span> <span class="o">*</span> <span class="n">multi</span><span class="p">)</span>
                    <span class="k">return</span> <span class="nb">sum</span>

        <span class="k">return</span> <span class="nb">sum</span>

    <span class="k">def</span> <span class="nf">ComputeListToPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">Q</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">lastT</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)):</span>

            <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">tm</span> <span class="o">-</span> <span class="n">t</span>

            <span class="n">N</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">df</span> <span class="o">&lt;=</span> <span class="n">seconds</span><span class="p">:</span>
                <span class="n">lastT</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">Q</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">lastT</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">t1</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span>
                    <span class="n">df1</span> <span class="o">=</span> <span class="n">tm</span> <span class="o">-</span> <span class="n">t1</span>
                    <span class="n">nv</span> <span class="o">=</span> <span class="n">ComputerSL</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
                    <span class="n">computedV</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
                    <span class="n">lastT</span> <span class="o">=</span>  <span class="p">(</span> <span class="n">computedV</span> <span class="o">*</span> <span class="n">Q</span><span class="p">)</span>
                    <span class="k">return</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">lastT</span><span class="p">,</span> <span class="n">i</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">lastT</span><span class="p">,</span> <span class="n">N</span></div>

<span class="kn">import</span> <span class="nn">operator</span>
<div class="viewcode-block" id="F25"><a class="viewcode-back" href="../code.html#stdcomQtC20.F25">[docs]</a><span class="k">class</span> <span class="nc">F25</span><span class="p">(</span><span class="n">HistoryDelay</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    F25 Lambda tuned Algorith</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">G</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">TC</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">LAMBDA</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">TAU</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">TC</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">e_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">y_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">lastTime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="n">LAMBDA</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">TC</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">TAU</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        G gain ...</span>
<span class="sd">        LAMBDA</span>
<span class="sd">        TC Time Constant</span>
<span class="sd">        TAU</span>
<span class="sd">        steps   is really not used, it is for history storage, but this algorithm uses tau and tc to efficently project storage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="p">(</span><span class="n">TC</span> <span class="o">+</span> <span class="n">TAU</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="n">TC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LAMBDA</span> <span class="o">=</span> <span class="n">LAMBDA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAU</span> <span class="o">=</span> <span class="n">TAU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="F25.Control"><a class="viewcode-back" href="../code.html#stdcomQtC20.F25.Control">[docs]</a>    <span class="k">def</span> <span class="nf">Control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">float</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        0 is always the target so the value is delta to 0, it is the error</span>
<span class="sd">        returns control move</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">nowTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">dfTime</span> <span class="o">=</span> <span class="n">nowTime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span> <span class="o">=</span> <span class="n">nowTime</span>
        <span class="k">if</span> <span class="n">dfTime</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">.0001</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dfTime</span><span class="p">)</span>

        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAU</span> <span class="o">/</span> <span class="n">T</span>

        <span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">T</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>

        <span class="n">APrime</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span>
        <span class="n">SMY</span><span class="p">,</span> <span class="n">YNEM1</span><span class="p">,</span> <span class="n">N</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ComputeListToPosition</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAU</span><span class="p">,</span> <span class="o">-</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">YNEM1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="o">*</span><span class="n">Q</span><span class="p">)</span> <span class="o">+</span> <span class="n">SMY</span> <span class="o">+</span> <span class="n">K</span> <span class="o">*</span> <span class="p">(</span> <span class="n">value</span> <span class="o">+</span> <span class="n">APrime</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_m_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_m_1</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Y</span></div>


<div class="viewcode-block" id="F25.Reset"><a class="viewcode-back" href="../code.html#stdcomQtC20.F25.Reset">[docs]</a>    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset, normally just make a new controller, but if you want you can reset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastTime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_m_1</span> <span class="o">=</span> <span class="mf">0.0</span>\</div></div>






<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">stdcomQtargs</span> <span class="kn">import</span> <span class="n">stdcomQtargs</span> <span class="k">as</span> <span class="n">arguments</span>
<span class="k">except</span> <span class="p">:</span>
    <span class="kn">from</span> <span class="nn">stdcomQt.stdcomQtargs</span> <span class="kn">import</span> <span class="n">stdcomQtargs</span> <span class="k">as</span> <span class="n">arguments</span>

<div class="viewcode-block" id="MapToZones"><a class="viewcode-back" href="../code.html#stdcomQtC20.MapToZones">[docs]</a><span class="k">class</span> <span class="nc">MapToZones</span><span class="p">()</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    args = edge_allow_0=True   allows 0&#39;s at the edges</span>
<span class="sd">           middle_allow_0=False allows 0&#39;s in the middle</span>
<span class="sd">           start_s=1   starting slice number or databox number</span>
<span class="sd">           end_s=20    ending slice number of databox number</span>
<span class="sd">           left_s=1    if rev with right_s then porfile is to be reversed</span>
<span class="sd">           right_s=20</span>
<span class="sd">           offset=0.0    offset in units of total_s_width actuator to headbox</span>
<span class="sd">           total_s_width=100   total slice width or headbox width</span>
<span class="sd">           min_d_width=6    units of total_s_width, the min actuator wisth</span>
<span class="sd">           d_count=10       number of actuators</span>

<span class="sd">           maps profile from scanner to actuator zones</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">edge_allow_0</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">middle_allow_0</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">start_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">end_s</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">left_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">right_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_s_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">min_d_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">d_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">THRESHOLD</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">.0000001</span><span class="p">)</span>
    <span class="n">MAXVAL</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1.0E38</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_allow_0</span> <span class="o">=</span> <span class="nb">bool</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;edge_allow_0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_allow_0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">middle_allow_0</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;middle_allow_0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">middle_allow_0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;start_s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_s</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;end_s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_s</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_s</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;left_s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_s</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;right_s&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">right_s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span>  <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_s_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;total_s_width&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_s_width</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_d_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;min_d_width&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_d_width</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_count</span> <span class="o">=</span> <span class="nb">int</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getDefault</span><span class="p">(</span><span class="s2">&quot;d_count&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_count</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">CheckBound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">invert</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invert</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span>
            <span class="n">right</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span>
            <span class="n">right</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span>
        <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>  <span class="c1"># out on start side</span>
            <span class="k">if</span> <span class="n">right</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># &amp; on end side */</span>
                <span class="k">return</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">3</span>  <span class="c1"># completely out on start side */</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># partially out on start side */</span>
        <span class="k">elif</span> <span class="n">left</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># out on end side */</span>
            <span class="k">if</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>  <span class="c1"># &amp; on start side */</span>
                <span class="k">return</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">right</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">4</span>  <span class="c1"># completely out on end side */</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># partially out on end side */</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># partially out on start side */</span>
            <span class="k">elif</span> <span class="n">right</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># partially out on end side */</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># in bounds */</span>

    <span class="k">def</span> <span class="nf">ZeroCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">src</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">src</span>

<div class="viewcode-block" id="MapToZones.Control"><a class="viewcode-back" href="../code.html#stdcomQtC20.MapToZones.Control">[docs]</a>    <span class="k">def</span> <span class="nf">Control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enter with profile, return with profile mapped to zone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_s</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_s</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_s</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">interm</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_s</span><span class="p">)</span>
        <span class="n">interm</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_s_width</span> <span class="o">/</span> <span class="n">interm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_d_width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_edge</span> <span class="o">+=</span> <span class="mf">1.</span>

        <span class="n">dest</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_count</span>

        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZeroCheck</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lcstart_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_s</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">lcstart_s</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">s</span> <span class="o">-=</span> <span class="n">lcstart_s</span>

        <span class="n">lcend_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_s</span>

        <span class="n">p</span> <span class="o">=</span>  <span class="n">s</span> <span class="o">+</span> <span class="n">lcend_s</span>


        <span class="k">while</span> <span class="n">src</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">lcend_s</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">p</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">right_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_edge</span>
        <span class="n">left_edge</span> <span class="o">=</span> <span class="n">right_edge</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_count</span><span class="p">):</span>
            <span class="n">left_edge</span> <span class="o">=</span> <span class="n">right_edge</span>  <span class="c1"># next d in s space * /</span>
            <span class="n">right_edge</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>

            <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckBound</span><span class="p">(</span><span class="n">left_edge</span><span class="p">,</span> <span class="n">right_edge</span><span class="p">,</span> <span class="n">lcstart_s</span><span class="p">,</span> <span class="n">lcend_s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># completely in bounds</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">left_edge</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">right_edge</span>

            <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># partially out on start side</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">lcstart_s</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">right_edge</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">left_edge</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">lcstart_s</span>

            <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># partially out on end side</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">left_edge</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">lcend_s</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">lcend_s</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">right_edge</span>

            <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># completely out on start side</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">lcstart_s</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">lcstart_s</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># completely out on end side</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">lcend_s</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">lcend_s</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># completely out of bounds</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">lcstart_s</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">lcend_s</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">left</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">:</span>  <span class="c1"># inverted so right edge is less than left</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">left</span>  <span class="c1"># swap to do summation * /</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">right</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">temp</span>

            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAXVAL</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">divisor</span> <span class="o">-=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span>  <span class="c1"># reduce divisor by width of this partial s elem * /</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">)]</span>  <span class="c1"># sum or max / min an edge * /</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>
            <span class="c1"># .....................................................................</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">k</span><span class="p">):</span>  <span class="c1"># d lies completely within a single s * /</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">left</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">s</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">src</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">divisor</span> <span class="o">-=</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>  <span class="c1"># reduce divisor by width of this partial s elem * /</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># sum or max a partial edge * /</span>
                    <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>

                <span class="n">m</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">):</span>
                        <span class="n">divisor</span> <span class="o">-=</span> <span class="mf">1.</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">sum</span> <span class="o">+=</span> <span class="n">src</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">bounds</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">dest</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">divisor</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span> <span class="ow">and</span> <span class="nb">sum</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>  <span class="c1"># check valid divisor * /</span>
                    <span class="n">dest</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">divisor</span>  <span class="c1"># * new  average in d * /</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dest</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># use the adjacent value</span>

        <span class="k">return</span> <span class="n">dest</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">databoxes</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">parameters</span><span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;start_s=1&quot;</span><span class="p">,</span> <span class="s2">&quot;end_s=10&quot;</span><span class="p">,</span> <span class="s2">&quot;left_s=1&quot;</span><span class="p">,</span> <span class="s2">&quot;right_s=10&quot;</span><span class="p">,</span> <span class="s2">&quot;offset=3&quot;</span><span class="p">,</span> <span class="s2">&quot;total_s_width=120&quot;</span><span class="p">,</span> <span class="s2">&quot;min_d_width=2&quot;</span><span class="p">,</span> <span class="s2">&quot;d_count=40&quot;</span>  <span class="p">]</span>

    <span class="n">mapclass</span> <span class="o">=</span> <span class="n">MapToZones</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">mapclass</span><span class="o">.</span><span class="n">Control</span><span class="p">(</span><span class="n">databoxes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>



    <span class="n">sleepTime</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">f25</span> <span class="o">=</span> <span class="n">F25</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">.018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">spt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">hl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">9</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Q1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">f25</span><span class="o">.</span><span class="n">Control</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">hl</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="n">hl</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">hl</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span> <span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleepTime</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">sleepTime</span><span class="p">)</span>
        <span class="n">T1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">Q1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">tm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T_1$ SP&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T_1$ PV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Eng Value ($^oC$)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$Q_1$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Actuator (%)&#39;</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (Seconds)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">stdcomQt</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Code Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Ed Chapman.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>