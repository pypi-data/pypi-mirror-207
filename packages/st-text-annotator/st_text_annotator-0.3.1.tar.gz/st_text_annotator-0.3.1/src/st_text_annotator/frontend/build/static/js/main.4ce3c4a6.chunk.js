(this["webpackJsonpsteamlit-text-annotator"]=this["webpackJsonpsteamlit-text-annotator"]||[]).push([[0],{33:function(e,t,n){"use strict";n.r(t);var a=n(18),r=n(4),s=n(5),c=n(0),o=n(1),i=n(2),u=n(3),l=n(12),d=(n(13),n(7)),f=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={text:"",actual_text:[],annotations:[],selectedReference:0},e.getCharactersCountUntilNode=function(e,t){for(var n=document.createTreeWalker(t||document.body,NodeFilter.SHOW_TEXT,null),a=0;n.nextNode();){var r;if(n.currentNode===e)break;a+=(null===(r=n.currentNode.textContent)||void 0===r?void 0:r.length)||0}return a},e.handleMouseUp=Object(s.a)(Object(r.a)().mark((function t(){var n,a,s,c,o,i,u,d,f,x,h,v,b,p,m,j,g,O,y,k,w,C,S,R,A,N,T,_,q,M,U;return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=null===(n=document.getSelection())||void 0===n?void 0:n.getRangeAt(0))||""===a.toString().trim()){t.next=40;break}o=a.toString(),i=a.startOffset,u=a.endOffset,d=0,f=0,x=document.getElementById("actual-text"),h=e.getCharactersCountUntilNode(a.startContainer,x),v=e.getCharactersCountUntilNode(a.endContainer,x),i+=h,u+=v;case 12:if(" "===(null===(b=document.querySelector("#actual-text"))||void 0===b||null===(p=b.textContent)||void 0===p?void 0:p.charAt(i+d-1))||void 0===(null===(m=document.querySelector("#actual-text"))||void 0===m||null===(j=m.textContent)||void 0===j?void 0:j.charAt(i+d-1))){t.next=18;break}if(""!==(null===(g=document.querySelector("#actual-text"))||void 0===g||null===(O=g.textContent)||void 0===O?void 0:O.charAt(i+d-1))){t.next=15;break}return t.abrupt("break",18);case 15:d-=1,t.next=12;break;case 18:if(" "===(null===(y=document.querySelector("#actual-text"))||void 0===y||null===(k=y.textContent)||void 0===k?void 0:k.charAt(u+f))||void 0===(null===(w=document.querySelector("#actual-text"))||void 0===w||null===(C=w.textContent)||void 0===C?void 0:C.charAt(u+f))){t.next=24;break}if(""!==(null===(S=document.querySelector("#actual-text"))||void 0===S||null===(R=S.textContent)||void 0===R?void 0:R.charAt(u+f))){t.next=21;break}return t.abrupt("break",24);case 21:f+=1,t.next=18;break;case 24:if(o=(null===(s=document.querySelector("#actual-text"))||void 0===s||null===(c=s.textContent)||void 0===c?void 0:c.slice(i+d,u+f))||"",f>0)for(A=/[.,/#!$%^&*;:{}=\-_`~()]$/g;o.match(A);)o=o.slice(0,-1),f-=1;if(N=e.state,T=N.annotations,_=N.selectedReference,T[_]||(T[_]=[]),q=i+d,M=u+f,!e.isAnnotated(q,M)){t.next=36;break}return U=e.removeAnnotation(q,M),t.next=34,e.setState({annotations:U});case 34:t.next=39;break;case 36:return T[_].push({start:q,end:M,label:o}),t.next=39,e.setState({annotations:T});case 39:l.a.setComponentValue(T);case 40:e.setState({actual_text:e.renderText()});case 41:case"end":return t.stop()}}),t)}))),e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=Object(s.a)(Object(r.a)().mark((function e(){var t,n,a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.args,n=t.text,a=t.annotations,e.next=3,this.setState({text:n,annotations:a});case 3:return e.next=5,this.setState({actual_text:this.renderText()});case 5:l.a.setComponentValue(a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isAnnotated",value:function(e,t){var n=this.state,a=n.annotations,r=n.selectedReference;if(!a[r])return!1;for(var s=0;s<a[r].length;s++)if(e>=a[r][s].start&&t<=a[r][s].end||e<=a[r][s].start&&t>=a[r][s].end||e<=a[r][s].start&&t>a[r][s].start&&t<=a[r][s].end||e>=a[r][s].start&&e<a[r][s].end&&t>=a[r][s].end)return!0;return!1}},{key:"removeAnnotation",value:function(e,t){for(var n=this.state,a=n.annotations,r=n.selectedReference,s=0;s<a[r].length;s++)if(e>=a[r][s].start&&t<=a[r][s].end||e<=a[r][s].start&&t>=a[r][s].end||e<=a[r][s].start&&t>a[r][s].start&&t<=a[r][s].end||e>=a[r][s].start&&e<a[r][s].end&&t>=a[r][s].end){a[r].splice(s,1);break}return 0===a[r].length&&a.splice(r,1),a}},{key:"addReference",value:function(){var e=Object(s.a)(Object(r.a)().mark((function e(){var t,n;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.annotations)[this.state.selectedReference]||0!==t[this.state.selectedReference].length){e.next=3;break}return e.abrupt("return");case 3:return n=t.length+1,t[n]||(t[n]=[]),e.next=7,this.setState({selectedReference:n,annotations:t});case 7:this.setState({actual_text:this.renderText()});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"selectReference",value:function(){var e=Object(s.a)(Object(r.a)().mark((function e(t){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.selectedReference!==t&&this.state.annotations[t]){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.setState({selectedReference:t});case 4:this.setState({actual_text:this.renderText()});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeReference",value:function(){var e=Object(s.a)(Object(r.a)().mark((function e(t){var n;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this.state.annotations).splice(t,1),e.next=4,this.setState({annotations:n,selectedReference:0});case 4:this.setState({actual_text:this.renderText()}),l.a.setComponentValue(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderText",value:function(){var e=this.state,t=e.text,n=e.annotations,a=e.selectedReference,r=[];if(!n[a])return[Object(d.jsx)("span",{children:t})];var s=0;return n[a].length>0&&n[a].sort((function(e,t){return e.start-t.start})),n[a].forEach((function(e,n){r.push(Object(d.jsx)("span",{children:t.substring(s,e.start)})),r.push(Object(d.jsx)("span",{className:"annotated bg-blue-500 text-gray-100",children:t.substring(e.start,e.end)})),s=e.end})),r.push(Object(d.jsx)("span",{children:t.substring(s,t.length)})),r}},{key:"render",value:function(){var e=this;return Object(d.jsxs)("div",{children:[Object(d.jsxs)("div",{className:"flex flex-row flex-wrap",children:[Object(d.jsx)("div",{className:"flex flex-wrap px-4 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100 bg-blue-500 text-gray-100",onClick:function(){return e.addReference()},children:Object(d.jsx)("span",{children:"Add"})}),this.state.annotations.map((function(t,n){var a;return Object(d.jsxs)("span",{className:"flex flex-wrap pl-4 pr-2 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100"+(e.state.selectedReference===n?" bg-blue-500 text-gray-100":" bg-blue-900 text-gray-200"),onClick:function(){e.selectReference(n)},children:[null===(a=t[0])||void 0===a?void 0:a.label,Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-3 hover:text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",onClick:function(){e.removeReference(n)},children:Object(d.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"})})]},n)}))]}),Object(d.jsx)("div",{id:"actual-text",className:"mt-5 h-full",onMouseUp:this.handleMouseUp,children:this.state.actual_text})]})}}]),n}(l.b),x=Object(l.c)(f),h=document.getElementById("root");Object(a.createRoot)(h).render(Object(d.jsx)(x,{}))}},[[33,1,2]]]);
//# sourceMappingURL=main.4ce3c4a6.chunk.js.map