{"version":3,"sources":["Annotation.tsx","index.tsx"],"names":["Annotation","_StreamlitComponentBa","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","state","text","actual_text","annotations","selectedReference","getCharactersCountUntilNode","node","parent","walker","document","createTreeWalker","body","NodeFilter","SHOW_TEXT","charCount","nextNode","_walker$currentNode$t","currentNode","textContent","handleMouseUp","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_document$getSelectio","selection","_document$querySelect13","_document$querySelect14","selectedText","startIndex","endIndex","container","charsBeforeStart","charsBeforeEnd","_document$querySelect","_document$querySelect2","_document$querySelect3","_document$querySelect4","_document$querySelect5","_document$querySelect6","_document$querySelect7","_document$querySelect8","_document$querySelect9","_document$querySelect10","_document$querySelect11","_document$querySelect12","re","_this$state","newAnnotations","wrap","_context","prev","next","getSelection","getRangeAt","toString","trim","startOffset","endOffset","getElementById","startContainer","endContainer","querySelector","charAt","undefined","abrupt","slice","match","isAnnotated","removeAnnotation","setState","push","start","end","label","Streamlit","setComponentValue","renderText","stop","_createClass","key","value","_componentDidMount","_callee2","_this$props$args","_context2","this","props","_this$state2","i","_this$state3","splice","_addReference","_callee3","index","_context3","_selectReference","_callee4","_context4","_x","_removeReference","_callee5","_context5","_x2","_this$state4","_jsx","children","sort","a","b","forEach","annotation","substring","className","_this2","_jsxs","onClick","addReference","map","reference","_reference$","selectReference","xmlns","viewBox","fill","removeReference","fillRule","d","id","onMouseUp","StreamlitComponentBase","withStreamlitConnection","createRoot","render","MyComponent"],"mappings":"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","file":"static/js/main.5de43153.chunk.js","sourcesContent":["import {\n  Streamlit,\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React from \"react\"\n\ninterface Reference {\n  start: number,\n  end: number,\n  label: string\n}\n\ninterface State {\n  text: string\n  actual_text: JSX.Element[]\n  selectedReference: number\n  annotations: Reference[][]\n}\n\nclass Annotation extends StreamlitComponentBase<State> {\n  state: State = {\n    text: \"\",\n    actual_text: [],\n    annotations: [],\n    selectedReference: 0\n  }\n\n  async componentDidMount(): Promise<void> {\n    const { text, annotations } = this.props.args\n\n    await this.setState({ text, annotations })\n    await this.setState({ actual_text: this.renderText() })\n    Streamlit.setComponentValue(annotations)\n  }\n\n  isAnnotated(start: number, end: number): boolean {\n    const { annotations, selectedReference } = this.state\n    \n    if (!annotations[selectedReference]) {\n      return false\n    }\n\n    for (let i = 0; i < annotations[selectedReference].length; i++) {\n      if (\n        (start >= annotations[selectedReference][i].start && end <= annotations[selectedReference][i].end) ||\n        (start <= annotations[selectedReference][i].start && end >= annotations[selectedReference][i].end) ||\n        (start <= annotations[selectedReference][i].start && end > annotations[selectedReference][i].start && end <= annotations[selectedReference][i].end) ||\n        (start >= annotations[selectedReference][i].start && start < annotations[selectedReference][i].end && end >= annotations[selectedReference][i].end)\n        ) {\n        return true\n      }\n    }\n    return false\n  }\n\n  removeAnnotation(start: number, end: number): Reference[][] {\n    const { annotations, selectedReference } = this.state\n\n    for (let i = 0; i < annotations[selectedReference].length; i++) {\n      if (\n        (start >= annotations[selectedReference][i].start && end <= annotations[selectedReference][i].end) ||\n        (start <= annotations[selectedReference][i].start && end >= annotations[selectedReference][i].end) ||\n        (start <= annotations[selectedReference][i].start && end > annotations[selectedReference][i].start && end <= annotations[selectedReference][i].end) ||\n        (start >= annotations[selectedReference][i].start && start < annotations[selectedReference][i].end && end >= annotations[selectedReference][i].end)\n        ) {\n        annotations[selectedReference].splice(i, 1)\n        break\n      }\n    }\n\n    if (annotations[selectedReference].length === 0) {\n      annotations.splice(selectedReference, 1)\n    }\n\n    return annotations\n  }\n\n  getCharactersCountUntilNode = (node: Node, parent: HTMLElement | null) => {\n    const walker = document.createTreeWalker(\n      parent || document.body,\n      NodeFilter.SHOW_TEXT,\n      null,\n    );\n    \n    let charCount = 0;\n    while (walker.nextNode()) {\n      if (walker.currentNode === node) {\n        break;\n      }\n      charCount += walker.currentNode.textContent?.length || 0;\n    }\n\n    return charCount;\n  }\n\n  handleMouseUp = async () => {\n    const selection = document.getSelection()?.getRangeAt(0)\n\n    if (selection && selection.toString().trim() !== \"\") {\n      let selectedText = selection.toString()\n\n      let startIndex = selection.startOffset\n      let endIndex = selection.endOffset\n\n      const container = document.getElementById(\"actual-text\")\n      const charsBeforeStart = this.getCharactersCountUntilNode(selection.startContainer, container);\n      const charsBeforeEnd = this.getCharactersCountUntilNode(selection.endContainer, container);\n\n      startIndex += charsBeforeStart\n      endIndex += charsBeforeEnd\n\n      while (document.querySelector(\"#actual-text\")?.textContent?.charAt(startIndex - 1) !== \" \" && document.querySelector(\"#actual-text\")?.textContent?.charAt(startIndex - 1) !== undefined) {\n        if (document.querySelector(\"#actual-text\")?.textContent?.charAt(startIndex - 1) === '') {\n          break\n        }\n\n        startIndex -= 1\n      }\n\n      while (document.querySelector(\"#actual-text\")?.textContent?.charAt(endIndex) !== \" \" && document.querySelector(\"#actual-text\")?.textContent?.charAt(endIndex) !== undefined) {\n        if (document.querySelector(\"#actual-text\")?.textContent?.charAt(endIndex) === '') {\n          break\n        }\n\n        endIndex += 1\n      }\n\n      selectedText = document.querySelector(\"#actual-text\")?.textContent?.slice(startIndex, endIndex) || \"\"\n\n      // remove commas, periods, etc. from the end of the selection\n      const re = /[.,/#!$%^&*;:{}=\\-_`~()]$/g\n      while (selectedText.match(re)) {\n        selectedText = selectedText.slice(0, -1)\n        endIndex -= 1\n      }\n\n      const { annotations, selectedReference } = this.state\n\n      if (!annotations[selectedReference]) {\n        annotations[selectedReference] = []\n      }\n\n      if (this.isAnnotated(startIndex, endIndex)) {\n        const newAnnotations = this.removeAnnotation(startIndex, endIndex)\n        await this.setState({ annotations: newAnnotations })\n      } else {\n        annotations[selectedReference].push({ start: startIndex, end: endIndex, label: selectedText })\n        await this.setState({ annotations })\n      }\n\n      Streamlit.setComponentValue(annotations)\n    }\n\n    this.setState({ actual_text: this.renderText() })\n  }\n\n  async addReference(): Promise<void> {\n    const { annotations } = this.state\n\n    // if selected annotation is empty do not add a new one\n    if (annotations[this.state.selectedReference] && annotations[this.state.selectedReference].length === 0) {\n      return\n    }\n\n    const index = annotations.length + 1\n    \n    if (!annotations[index]) {\n      annotations[index] = []\n    }\n\n    await this.setState({ \n      selectedReference: index,\n      annotations\n    })\n\n    this.setState({ actual_text: this.renderText() })\n  }\n\n  async selectReference(index: number): Promise<void> {\n    if (this.state.selectedReference === index || !this.state.annotations[index]) {\n      return\n    }\n\n    await this.setState({ selectedReference: index })\n    this.setState({ actual_text: this.renderText() })\n  }\n\n  async removeReference(index: number): Promise<void> {\n    const { annotations } = this.state\n\n    annotations.splice(index, 1)\n\n    await this.setState({ annotations, selectedReference: 0 })\n    this.setState({ actual_text: this.renderText() })\n    Streamlit.setComponentValue(annotations)\n  }\n\n  renderText(): JSX.Element[] {\n    const { text, annotations, selectedReference } = this.state\n    const actual_text: JSX.Element[] = []\n\n    if (!annotations[selectedReference]) {\n      return [<span>{text}</span>]\n    }\n\n\n    let start = 0\n\n    if (annotations[selectedReference].length > 0) {\n      annotations[selectedReference].sort((a, b) => a.start - b.start)\n    }\n\n    annotations[selectedReference].forEach((annotation, index) => {\n      actual_text.push(<span>{text.substring(start, annotation.start)}</span>)\n      actual_text.push(<span className=\"annotated bg-blue-500 text-gray-100\">{text.substring(annotation.start, annotation.end)}</span>)\n      start = annotation.end\n    })\n    actual_text.push(<span>{text.substring(start, text.length)}</span>)\n\n\n    return actual_text\n  }\n\n  render(): React.ReactNode {\n    return (\n      <div>\n        <div className=\"flex flex-row flex-wrap\">\n          <div\n            className=\"flex flex-wrap px-4 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100 bg-blue-500 text-gray-100\"\n            onClick={ () => this.addReference() }\n            >\n            <span>Add</span>\n          </div>\n          {this.state.annotations.map((reference, index) => (\n            <span\n              key={index}\n              className={\"flex flex-wrap pl-4 pr-2 py-2 m-1 justify-between items-center text-sm font-medium cursor-pointer hover:bg-blue-600 hover:text-gray-100\" + (this.state.selectedReference === index ? \" bg-blue-500 text-gray-100\" : \" bg-blue-900 text-gray-200\")}\n              onClick={() => { this.selectReference(index) }}\n            >\n              {reference[0]?.label}\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                className=\"h-5 w-5 ml-3 hover:text-gray-300\" viewBox=\"0 0 20 20\"\n                fill=\"currentColor\"\n                onClick={() => { this.removeReference(index) }}\n              >\n                <path\n                  fillRule=\"evenodd\"\n                  d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"\n                />\n              </svg>\n            </span>\n          ))}\n        </div>\n        <div id=\"actual-text\" className=\"mt-5 h-full\" onMouseUp={this.handleMouseUp}>\n          {this.state.actual_text}\n        </div>\n      </div>\n    )\n  }\n}\n\n\nexport default withStreamlitConnection(Annotation)\n\n","import { createRoot } from 'react-dom/client';\nimport MyComponent from \"./Annotation\"\nimport React from 'react';\n\nconst container = document.getElementById(\"root\")\nconst root = createRoot(container)\n\nroot.render(<MyComponent />)\n"],"sourceRoot":""}